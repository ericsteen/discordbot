import discord
from discord.ext import commands
import re

class TikTok(commands.Cog):

    def __init__(self, bot):
        self.bot = bot
        print('tiktok embedder init')

    async def send_message_tiktok(self, ctx, message: str):
        print('sending message')
        channel_name = 'tiktok-premium'
        target_channel = discord.utils.get(ctx.guild.text_channels, name=channel_name)

        if target_channel:
            await target_channel.send(message)
        else:
            await ctx.send(f"Channel '{channel.name}' not found")
    @commands.Cog.listener()
    async def on_message(self, message):
        print('message received')
        if message.author.bot:
            return

        if 'https://www.tiktok.com' in message.content:
            print('found tiktok link')
            breakpoint()
            newlink = re.sub(r'\www.tiktok.com\b', 'www.vxtiktok.com', message.content)
            ctx = await self.bot.get_context(message)
            await self.send_message_tiktok(ctx, newlink)

async def setup(bot):
    await bot.add_cog(TikTok(bot))
